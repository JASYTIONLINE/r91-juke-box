<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>DigiPort Jukebox ‚Äì Site Map</title>
  <meta name="sitemap" content="exclude" />

  <!-- ============================================================================
       STYLESHEETS
       ----------------------------------------------------------------------------
       This page is located at /content/sitemap.html, two levels deep from the root.

       We use an ABSOLUTE URL for the custom theme CSS file to ensure consistent loading
       in all hosting environments. Bootstrap is loaded from a CDN.
       ============================================================================ -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link rel="stylesheet" href="https://jasytionline.github.io/r91-juke-box/assets/css/custom.css" />

  <!-- ============================================================================
       INLINE PAGE-SPECIFIC STYLES
       ----------------------------------------------------------------------------
       These styles are specific to the sitemap layout and are not used elsewhere.
       We define a grid layout that adapts responsively and styles the link appearance.

       Class names used here (.sitemap-grid, .sitemap-link) are scoped only to this page.
       ============================================================================ -->
  <style>
    .sitemap-container {
      max-width: 1920px;
      margin: 0 auto;
    }

    .sitemap-link {
      display: inline-block;
      margin: 0.25rem 0;
      color: var(--jukebox-gold);
      text-decoration: none;
      font-weight: 500;
      transition: color 0.2s ease;
    }

    .sitemap-link:hover {
      text-decoration: underline;
      color: #ffe066;
    }

    .sitemap-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
      gap: 0.5rem 2rem;
      justify-content: start;
    }

    @media (min-width: 1200px) {
      .sitemap-grid {
        grid-template-columns: repeat(8, 1fr); /* max 8 per row */
      }
    }
  </style>
</head>

<body>

  <!-- ============================================================================
       SHARED HEADER INJECTION
       ----------------------------------------------------------------------------
       As with all major pages, we inject the shared nav bar using fetch().

       The fetch path is absolute to ensure compatibility at this folder depth.
       ============================================================================ -->
  <div id="site-header"></div>

  <!-- ============================================================================
       HERO SECTION ‚Äî SITEMAP TITLE
       ----------------------------------------------------------------------------
       Introduces the sitemap with a friendly headline and context.
       We use .section-card for consistent styling, centered alignment, and spacing.
       ============================================================================ -->
  <header class="section-card text-center py-5">
    <h1 class="text-gold fw-bold">üó∫Ô∏è Site Map</h1>
    <p class="text-muted">
      These are the most commonly visited pages on the site. The sitemap updates
      dynamically based on the site‚Äôs content structure file (tree.json).
    </p>
  </header>

  <!-- ============================================================================
       SITEMAP GRID CONTAINER
       ----------------------------------------------------------------------------
       This block dynamically loads all pages marked for inclusion in the sitemap
       from the JSON structure stored in /assets/data/tree.json.

       The layout is responsive using CSS grid, and links are styled using the
       .sitemap-link class for branding and hover effects.
       ============================================================================ -->
  <main class="container sitemap-container py-5">
    <section class="jukebox-card p-4">
      <div class="sitemap-grid" id="sitemapLinks">
        <!-- Links will be injected here via JavaScript -->
      </div>
    </section>
  </main>

  <!-- ============================================================================
       SHARED FOOTER INJECTION
       ----------------------------------------------------------------------------
       As with the header, we load the footer dynamically using fetch().
       We use an absolute URL so the footer always loads correctly.
       ============================================================================ -->
  <div id="site-footer"></div>

  <!-- ============================================================================
       PARTIAL INJECTION SCRIPT
       ----------------------------------------------------------------------------
       Injects header and footer via fetch(). Absolute paths are used for stability.
       ============================================================================ -->
  <script>
    fetch('https://jasytionline.github.io/r91-juke-box/partials/header.html')
      .then(res => res.text())
      .then(html => document.getElementById('site-header').innerHTML = html);

    fetch('https://jasytionline.github.io/r91-juke-box/partials/footer.html')
      .then(res => res.text())
      .then(html => document.getElementById('site-footer').innerHTML = html);
  </script>

  <!-- ============================================================================
       SITEMAP DYNAMIC LINK LOADER
       ----------------------------------------------------------------------------
       This script fetches /assets/data/tree.json and recursively walks the structure.

       Any node marked with `"sitemap": true` will be included. The title for each
       link is shown as the label, and the path is used as the href. Broken or 
       excluded entries are ignored.

       This system ensures the sitemap stays up-to-date as long as tree.json is maintained.
       ============================================================================ -->
  <script>
    fetch('https://jasytionline.github.io/r91-juke-box/assets/data/tree.json')
      .then(res => res.json())
      .then(tree => {
        const flatPages = [];

        function traverse(node) {
          if (node.children) {
            node.children.forEach(traverse);
          } else if (node.sitemap) {
            flatPages.push({
              path: node.path,
              title: node.title || node.name
            });
          }
        }

        traverse(tree);

        const container = document.getElementById('sitemapLinks');
        flatPages.forEach(page => {
          const link = document.createElement('a');
          link.href = `https://jasytionline.github.io/r91-juke-box/${page.path}`;
          link.textContent = page.title;
          link.className = 'sitemap-link';
          container.appendChild(link);
        });
      })
      .catch(err => {
        console.error('‚ùå Error loading sitemap data:', err);
        document.getElementById('sitemapLinks').innerHTML =
          '<p class="text-danger">‚ö†Ô∏è Failed to load sitemap data. Please try again later.</p>';
      });
  </script>

  <!-- ============================================================================
       BOOTSTRAP JAVASCRIPT
       ----------------------------------------------------------------------------
       Enables interactivity for nav elements and layout behaviors. CDN-hosted.
       ============================================================================ -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

</body>
</html>
