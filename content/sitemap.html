<!doctype html>
<html lang="en">
<head>
  <!-- ========================================================
       DigiPort / DragonEye Sitemap Page
       ========================================================
       PURPOSE:
       This page dynamically renders a human-readable site map
       using the folder tree exported into assets/data/tree.json.
       
       It allows users (or search engines) to:
       - View all navigable index.html pages
       - See clear, labeled links
       - Navigate via clean, branded UI

       It uses:
       - Bootstrap 5 (via CDN)
       - Your existing red/gold CSS theme
       - JavaScript (Fetch API) to render from JSON
  -->
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>DigiPort Site Map</title>

  <!-- === BOOTSTRAP STYLESHEET === -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

  <!-- === YOUR CUSTOM THEME === -->
  <link rel="stylesheet" href="../../assets/css/custom.css">

  <!-- === INTERNAL OVERRIDES FOR LAYOUT & VISUALS === -->
  <style>
    body {
      background-color: var(--jukebox-dark);
      color: var(--jukebox-text-light);
      font-family: "Segoe UI", Roboto, sans-serif;
    }

    .sitemap-card {
      background-color: var(--jukebox-red);
      border: 2px solid var(--jukebox-gold);
      border-radius: 0.5rem;
      padding: 1.5rem;
      margin-bottom: 2rem;
      box-shadow: 0 2px 6px rgba(0,0,0,0.4);
    }

    .sitemap-header {
      color: var(--jukebox-gold);
      font-weight: 700;
    }

    .folder, .file {
      cursor: pointer;
      user-select: none;
      display: block;
      padding: 0.3rem 0.5rem;
      margin-bottom: 0.2rem;
      border-radius: 0.25rem;
      transition: background-color 0.2s ease;
    }

    .folder:hover, .file:hover {
      background-color: rgba(255, 215, 0, 0.1);
    }

    .folder::before { content: "üìÅ "; }
    .file::before   { content: "üìÑ "; }

    a.file {
      text-decoration: none;
      color: var(--jukebox-text-light);
    }

    a.file:hover {
      color: var(--jukebox-gold);
    }

    .indent {
      margin-left: 1.2rem;
      border-left: 1px solid rgba(255, 215, 0, 0.2);
      padding-left: 1rem;
    }

    .search-box {
      background-color: var(--jukebox-dark);
      border: 2px solid var(--jukebox-gold);
      color: var(--jukebox-text-light);
    }
  </style>
</head>

<body>

  <!-- ===========================================================
       NAVBAR
       Shows DigiPort brand and keeps consistent styling.
       =========================================================== -->
  <nav class="navbar navbar-expand-lg">
    <div class="container-fluid">
      <a class="navbar-brand text-gold fw-bold" href="../../index.html">üéµ DigiPort</a>
      <span class="navbar-text text-muted">Site Map</span>
    </div>
  </nav>

  <!-- ===========================================================
       MAIN CONTENT WRAPPER
       Contains the title, description, search box, and rendered tree.
       =========================================================== -->
  <main class="container py-4">
    <div class="sitemap-card">
      <h1 class="sitemap-header mb-3">üìñ DigiPort Sitemap</h1>
      <p class="text-muted mb-3">
        This sitemap is <strong>auto-generated</strong> from your <code>tree.json</code> file.<br>
        Each folder that contains an <code>index.html</code> file will appear as a clickable page.
        Labels are extracted from the <code>&lt;title&gt;</code> tag in each HTML file.
      </p>

      <!-- === SEARCH INPUT === -->
      <input type="text" id="searchBox" class="form-control mb-4 search-box" placeholder="Search by page title or folder...">

      <!-- === WHERE WE RENDER THE TREE === -->
      <div id="sitemapContainer"></div>
    </div>
  </main>

  <!-- ===========================================================
       FOOTER
       Can include last updated date, site credits, etc.
       =========================================================== -->
  <footer class="text-center py-3 border-top border-warning">
    <p class="text-muted mb-0 small">
      &copy; 2025 DigiPort / DragonEye Universe ‚Äî Built dynamically from your folder tree.
    </p>
  </footer>

  <!-- ===========================================================
       JAVASCRIPT: LOAD & RENDER TREE.JSON
       Uses Fetch API to pull your JSON and build out the tree.
       =========================================================== -->
  <script>
    /**
     * Fetch the JSON structure created by your Node export script.
     * This file lives at /assets/data/tree.json.
     * The browser will read it, parse it, and use it to render
     * the sitemap with correct links and titles.
     */
    fetch('../../assets/data/tree.json')
      .then(response => {
        if (!response.ok) throw new Error('Could not load tree.json');
        return response.json();
      })
      .then(tree => {
        const container = document.getElementById('sitemapContainer');

        /**
         * renderNode()
         * Recursively renders folders and pages from the JSON.
         * Each node can have:
         * - name (raw folder name)
         * - indexPath (used to build a link)
         * - title (from HTML <title> tag)
         * - children (subfolders or files)
         */
        function renderNode(node, parent) {
          // Skip system folders (like .git)
          if (node.name.startsWith('.')) return;

          // Create a clickable link if the node represents a page
          if (node.indexPath) {
            const link = document.createElement('a');
            link.href = '../../' + node.indexPath;
            link.className = 'file';
            link.textContent = node.title || node.name;
            parent.appendChild(link);
          } 
          // Otherwise, render it as a non-clickable folder label
          else {
            const folder = document.createElement('div');
            folder.className = 'folder';
            folder.textContent = node.title || node.name;
            parent.appendChild(folder);
          }

          // Recursively render any children
          if (node.children && node.children.length > 0) {
            const childContainer = document.createElement('div');
            childContainer.className = 'indent';

            node.children.forEach(child => {
              if (typeof child === 'object') {
                renderNode(child, childContainer);
              }
            });

            parent.appendChild(childContainer);
          }
        }

        /**
         * The top of your tree.json is just the wrapper (r91-juke-box).
         * We skip it and go straight to rendering its children.
         */
        if (tree.children) {
          tree.children.forEach(child => {
            if (typeof child !== 'string') renderNode(child, container);
          });
        }

        /**
         * Enable search functionality.
         * When the user types in the search box, we filter which
         * items are visible based on whether they match the query.
         */
        const searchBox = document.getElementById('searchBox');
        searchBox.addEventListener('input', () => {
          const query = searchBox.value.toLowerCase();
          document.querySelectorAll('.file, .folder').forEach(el => {
            const matches = el.textContent.toLowerCase().includes(query);
            el.style.display = matches ? 'block' : 'none';
          });
        });
      })
      .catch(err => {
        // If anything fails, show an error message
        console.error('‚ùå Failed to load site map:', err);
        document.getElementById('sitemapContainer').innerHTML = `
          <p class="text-danger">‚ö†Ô∏è Could not load sitemap. Check if tree.json exists and is valid.</p>
        `;
      });
  </script>

</body>
</html>
